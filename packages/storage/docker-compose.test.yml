services:
  s3:
    image: localstack/localstack:4.12.0
    container_name: subspace_storage_s3_test
    ports:
      - "4567:4566"
    environment:
      SERVICES: s3
      AWS_DEFAULT_REGION: us-east-1
      AWS_ACCESS_KEY_ID: test
      AWS_SECRET_ACCESS_KEY: test
      AWS_EC2_METADATA_DISABLED: "true"
    healthcheck:
      test: [ "CMD", "curl", "-sf", "http://localhost:4566/_localstack/health" ]
      interval: 1s
      timeout: 2s
      retries: 30

  gcs:
    image: fsouza/fake-gcs-server:1.52.1
    container_name: subspace_storage_gcs_test
    ports:
      - "4444:4443"
    command: >
      -scheme http -port 4443 -public-host localhost:4444 -external-url http://localhost:4444
    healthcheck:
      test: [ "CMD", "wget", "-q", "--spider", "http://localhost:4443/storage/v1/b" ]
      interval: 1s
      timeout: 2s
      retries: 30
